# üìö Documentaci√≥n del Proyecto BlogApp

> **Aplicaci√≥n de Blog Full-Stack desarrollada con Amplication**

---

## üìã Tabla de Contenidos

- [üéØ Descripci√≥n General](#-descripci√≥n-general)
- [üèóÔ∏è Arquitectura del Sistema](#Ô∏è-arquitectura-del-sistema)
- [üìä Modelo de Datos](#-modelo-de-datos)
- [üîß Stack Tecnol√≥gico](#-stack-tecnol√≥gico)
- [üöÄ Instalaci√≥n y Configuraci√≥n](#-instalaci√≥n-y-configuraci√≥n)
- [üíª Desarrollo](#-desarrollo)
- [üê≥ Docker](#-docker)
- [üì° API Documentation](#-api-documentation)
- [üîê Autenticaci√≥n y Autorizaci√≥n](#-autenticaci√≥n-y-autorizaci√≥n)
- [üåê Frontend Admin](#-frontend-admin)
- [üìù Scripts Disponibles](#-scripts-disponibles)
- [üß™ Testing](#-testing)
- [üö¢ Deployment](#-deployment)
- [üìö Referencias](#-referencias)

---

## üéØ Descripci√≥n General

**BlogApp** es una aplicaci√≥n full-stack de gesti√≥n de blog que permite a los usuarios crear, editar y gestionar publicaciones con datos meteorol√≥gicos asociados. El proyecto est√° construido siguiendo una arquitectura de microservicios moderna y escalable.

### Caracter√≠sticas Principales

- ‚úÖ **CRUD completo** para usuarios, posts y datos meteorol√≥gicos
- ‚úÖ **API GraphQL y REST** autogeneradas
- ‚úÖ **Panel de administraci√≥n** web completo
- ‚úÖ **Autenticaci√≥n JWT** con control de acceso basado en roles
- ‚úÖ **Base de datos relacional** con PostgreSQL
- ‚úÖ **Cache y messaging** con Redis
- ‚úÖ **Containerizaci√≥n** completa con Docker
- ‚úÖ **Documentaci√≥n Swagger** integrada

---

## üèóÔ∏è Arquitectura del Sistema

```mermaid
graph TB
    Client[Cliente Web] --> LB[Load Balancer]
    LB --> Admin[Admin Panel<br/>React Admin]
    LB --> API[API Gateway<br/>NestJS]
    
    API --> Auth[Auth Service]
    API --> User[User Service]
    API --> Post[Post Service]
    API --> Weather[Weather Service]
    
    User --> DB[(PostgreSQL)]
    Post --> DB
    Weather --> DB
    
    API --> Redis[(Redis)]
    API --> Prisma[Prisma ORM]
    Prisma --> DB
    
    subgraph "Backend Services"
        Auth
        User
        Post
        Weather
    end
    
    subgraph "Data Layer"
        DB
        Redis
        Prisma
    end
```

### Componentes Principales

| Componente | Tecnolog√≠a | Puerto | Descripci√≥n |
|------------|------------|--------|-------------|
| **Backend API** | NestJS + GraphQL | 3000 | API principal del sistema |
| **Admin Panel** | React Admin | 3001 | Panel de administraci√≥n web |
| **Database** | PostgreSQL | 5432 | Base de datos principal |
| **Cache/Broker** | Redis | 6379 | Cache y message broker |

---

## üìä Modelo de Datos

### Diagrama de Entidades

```mermaid
erDiagram
    User ||--o{ Post : "creates"
    Post ||--|| WeatherDatum : "has"
    
    User {
        string id PK
        string email UK
        string username UK
        string password
        json roles
        datetime createdAt
        datetime updatedAt
    }
    
    Post {
        string id PK
        string title UK
        string content
        datetime date UK
        string userId FK
        datetime createdAt
        datetime updatedAt
    }
    
    WeatherDatum {
        string id PK
        json currentWeather
        string postsId FK
        datetime createdAt
        datetime updatedAt
    }
```

### Descripci√≥n de Entidades

#### üë§ **User (Usuario)**
```typescript
interface User {
  id: string;          // CUID √∫nico
  email: string;       // Email √∫nico del usuario
  username?: string;   // Nombre de usuario opcional
  password: string;    // Contrase√±a encriptada (bcrypt)
  roles?: Json;        // Roles y permisos del usuario
  posts: Post[];       // Posts creados por el usuario
  createdAt: DateTime; // Fecha de creaci√≥n
  updatedAt: DateTime; // √öltima actualizaci√≥n
}
```

#### üìù **Post (Publicaci√≥n)**
```typescript
interface Post {
  id: string;          // CUID √∫nico
  title: string;       // T√≠tulo √∫nico del post
  content: string;     // Contenido del post
  date?: DateTime;     // Fecha de publicaci√≥n
  userId?: string;     // ID del autor
  user?: User;         // Relaci√≥n con el usuario
  weather?: WeatherDatum; // Datos meteorol√≥gicos
  createdAt: DateTime; // Fecha de creaci√≥n
  updatedAt: DateTime; // √öltima actualizaci√≥n
}
```

#### üå§Ô∏è **WeatherDatum (Datos Meteorol√≥gicos)**
```typescript
interface WeatherDatum {
  id: string;             // CUID √∫nico
  currentWeather?: Json;  // Datos meteorol√≥gicos en JSON
  postsId?: string;       // ID del post asociado
  posts?: Post;           // Relaci√≥n con el post
  createdAt: DateTime;    // Fecha de creaci√≥n
  updatedAt: DateTime;    // √öltima actualizaci√≥n
}
```

---

## üîß Stack Tecnol√≥gico

### Backend
- **Framework**: NestJS 10.x
- **API**: GraphQL + Apollo Server
- **ORM**: Prisma 5.x
- **Base de Datos**: PostgreSQL 12
- **Cache**: Redis 7
- **Autenticaci√≥n**: JWT + Passport
- **Validaci√≥n**: class-validator + class-transformer
- **Documentaci√≥n**: Swagger/OpenAPI

### Frontend
- **Framework**: React 18 + TypeScript
- **UI Library**: React Admin 5.x + Material-UI
- **State Management**: React Admin integrado
- **HTTP Client**: Apollo Client (GraphQL)

### DevOps
- **Containerizaci√≥n**: Docker + Docker Compose
- **Build Tool**: Vite (Frontend) + NestJS CLI (Backend)
- **Testing**: Jest + Supertest
- **Linting**: ESLint + Prettier

---

## üöÄ Instalaci√≥n y Configuraci√≥n

### Prerrequisitos

- Node.js 18+ 
- npm o yarn
- Docker y Docker Compose
- PostgreSQL 12+ (si no usas Docker)
- Redis 7+ (si no usas Docker)

### 1. Clonar el Repositorio

```bash
git clone https://github.com/AlejandroHBerzosa/Amplication_blogApp.git
cd Amplication_blogApp
```

### 2. Variables de Entorno

Crear archivo `.env` en la ra√≠z del proyecto:

```env
# Database
DB_USER=admin
DB_PASSWORD=admin
DB_NAME=blog_db
DB_PORT=5432
DB_URL=postgresql://${DB_USER}:${DB_PASSWORD}@localhost:${DB_PORT}/${DB_NAME}

# Server
PORT=3000
BCRYPT_SALT=10

# JWT
JWT_SECRET=your-super-secret-jwt-key
JWT_EXPIRES_IN=7d

# Redis
REDIS_BROKER_HOST=localhost
REDIS_BROKER_PORT=6379

# GraphQL
GRAPHQL_PLAYGROUND=true
GRAPHQL_INTROSPECTION=true
```

### 3. Instalaci√≥n de Dependencias

#### Backend
```bash
cd apps/mi-backend-server
npm install
```

#### Frontend Admin
```bash
cd apps/mi-backend-admin
npm install
```

---

## üíª Desarrollo

### Opci√≥n 1: Desarrollo con Docker (Recomendado)

```bash
# Levantar todos los servicios
cd apps/mi-backend-server
npm run docker:dev

# En otra terminal - inicializar BD
npm run db:init
```

### Opci√≥n 2: Desarrollo Local

#### Backend
```bash
cd apps/mi-backend-server

# Instalar dependencias
npm install

# Generar cliente Prisma
npm run prisma:generate

# Ejecutar migraciones
npm run db:migrate-up

# Poblar base de datos
npm run seed

# Iniciar en modo desarrollo
npm run start:watch
```

#### Frontend Admin
```bash
cd apps/mi-backend-admin

# Instalar dependencias
npm install

# Iniciar servidor de desarrollo
npm start
```

### URLs de Desarrollo

- **API Backend**: http://localhost:3000
- **GraphQL Playground**: http://localhost:3000/graphql
- **Swagger Documentation**: http://localhost:3000/api
- **Admin Panel**: http://localhost:3001

---

## üê≥ Docker

### Estructura de Contenedores

```yaml
services:
  server:     # Backend NestJS
  migrate:    # Migraci√≥n de BD
  db:         # PostgreSQL
  redis_broker: # Redis
```

### Comandos Docker

```bash
# Desarrollo - Solo servicios externos
npm run docker:dev

# Producci√≥n - Todo el stack
docker-compose up -d

# Ver logs
docker-compose logs -f server

# Detener servicios
docker-compose down

# Limpiar vol√∫menes
docker-compose down --volumes
```

### Variables Docker

Crear `.env` con:
```env
DB_USER=admin
DB_PASSWORD=admin
DB_NAME=blog_db
DB_PORT=5432
PORT=3000
BCRYPT_SALT=10
REDIS_BROKER_HOST=redis_broker
REDIS_BROKER_PORT=6379
```

---

## üì° API Documentation

### GraphQL API

#### Endpoints Principales
- **GraphQL Endpoint**: `POST /graphql`
- **GraphQL Playground**: `GET /graphql` (solo desarrollo)

#### Queries Ejemplo

```graphql
# Obtener todos los posts
query GetPosts {
  posts {
    id
    title
    content
    date
    user {
      username
      email
    }
    weather {
      currentWeather
    }
  }
}

# Crear un post
mutation CreatePost($data: PostCreateInput!) {
  createPost(data: $data) {
    id
    title
    content
    date
  }
}
```

### REST API

La API REST est√° disponible autom√°ticamente en `/api`:

```bash
# Usuarios
GET    /api/users
POST   /api/users
GET    /api/users/:id
PATCH  /api/users/:id
DELETE /api/users/:id

# Posts
GET    /api/posts
POST   /api/posts
GET    /api/posts/:id
PATCH  /api/posts/:id
DELETE /api/posts/:id

# Weather Data
GET    /api/weather-data
POST   /api/weather-data
GET    /api/weather-data/:id
PATCH  /api/weather-data/:id
DELETE /api/weather-data/:id
```

### Swagger Documentation

Acceder a `http://localhost:3000/api` para ver la documentaci√≥n interactiva completa.

---

## üîê Autenticaci√≥n y Autorizaci√≥n

### Sistema de Autenticaci√≥n

#### 1. **Registro de Usuario**
```bash
POST /api/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "securePassword123",
  "username": "username"
}
```

#### 2. **Login**
```bash
POST /api/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "securePassword123"
}

# Response
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "user-id",
    "email": "user@example.com",
    "username": "username"
  }
}
```

#### 3. **Uso del Token**
```bash
GET /api/posts
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### Control de Acceso (RBAC)

#### Roles Disponibles
- **Admin**: Acceso completo al sistema
- **User**: Acceso a recursos propios
- **Guest**: Solo lectura

#### Configuraci√≥n de Permisos
```typescript
// En grants.json
{
  "user": {
    "post": {
      "create:own": ["*"],
      "read:own": ["*"],
      "update:own": ["*"],
      "delete:own": ["*"]
    }
  },
  "admin": {
    "post": {
      "create:any": ["*"],
      "read:any": ["*"],
      "update:any": ["*"],
      "delete:any": ["*"]
    }
  }
}
```

---

## üåê Frontend Admin

### Caracter√≠sticas del Panel Admin

- **Dashboard**: Vista general del sistema
- **Gesti√≥n de Usuarios**: CRUD completo con roles
- **Gesti√≥n de Posts**: Editor con preview
- **Datos Meteorol√≥gicos**: Asociaci√≥n autom√°tica
- **Autenticaci√≥n**: Login/logout integrado

### Estructura de Componentes

```
src/
‚îú‚îÄ‚îÄ App.tsx                 # Componente principal
‚îú‚îÄ‚îÄ Login.tsx              # P√°gina de login
‚îú‚îÄ‚îÄ auth-provider/         # Proveedores de autenticaci√≥n
‚îú‚îÄ‚îÄ data-provider/         # Conexi√≥n GraphQL
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îî‚îÄ‚îÄ Dashboard.tsx      # Dashboard principal
‚îú‚îÄ‚îÄ user/                  # Componentes de usuario
‚îÇ   ‚îú‚îÄ‚îÄ UserList.tsx
‚îÇ   ‚îú‚îÄ‚îÄ UserCreate.tsx
‚îÇ   ‚îú‚îÄ‚îÄ UserEdit.tsx
‚îÇ   ‚îî‚îÄ‚îÄ UserShow.tsx
‚îú‚îÄ‚îÄ post/                  # Componentes de posts
‚îî‚îÄ‚îÄ weatherDatum/          # Componentes de datos meteorol√≥gicos
```

### Personalizaci√≥n

#### Tema Personalizado
```typescript
// src/theme/theme.ts
export const theme = {
  palette: {
    primary: {
      main: '#1976d2',
    },
    secondary: {
      main: '#dc004e',
    },
  },
};
```

#### Data Provider Personalizado
```typescript
// src/data-provider/graphqlDataProvider.ts
import buildGraphQLProvider from "ra-data-graphql-amplication";

const dataProvider = buildGraphQLProvider({
  clientOptions: { uri: "http://localhost:3000/graphql" }
});
```

---

## üìù Scripts Disponibles

### Backend (`apps/mi-backend-server`)

| Script | Descripci√≥n |
|--------|-------------|
| `npm start` | Iniciar servidor en producci√≥n |
| `npm run start:watch` | Desarrollo con hot reload |
| `npm run start:debug` | Desarrollo con debugger |
| `npm run build` | Build para producci√≥n |
| `npm test` | Ejecutar tests |
| `npm run db:migrate-save` | Crear nueva migraci√≥n |
| `npm run db:migrate-up` | Aplicar migraciones |
| `npm run db:clean` | Reset completo de BD |
| `npm run db:init` | Inicializar BD + seed |
| `npm run seed` | Poblar BD con datos de prueba |
| `npm run prisma:generate` | Generar cliente Prisma |
| `npm run docker:dev` | Levantar servicios en Docker |

### Frontend (`apps/mi-backend-admin`)

| Script | Descripci√≥n |
|--------|-------------|
| `npm start` | Servidor de desarrollo |
| `npm run build` | Build para producci√≥n |
| `npm run serve` | Preview del build |
| `npm run type-check` | Verificar tipos TypeScript |
| `npm run lint` | Linting del c√≥digo |
| `npm run format` | Formatear c√≥digo |

---

## üß™ Testing

### Backend Testing

```bash
cd apps/mi-backend-server

# Ejecutar todos los tests
npm test

# Tests en modo watch
npm run test:watch

# Coverage report
npm run test:cov
```

### Estructura de Tests

```
src/
‚îú‚îÄ‚îÄ user/
‚îÇ   ‚îî‚îÄ‚îÄ user.service.spec.ts
‚îú‚îÄ‚îÄ post/
‚îÇ   ‚îî‚îÄ‚îÄ post.service.spec.ts
‚îî‚îÄ‚îÄ weatherDatum/
    ‚îî‚îÄ‚îÄ weatherDatum.service.spec.ts
```

### Ejemplo de Test

```typescript
describe('PostService', () => {
  let service: PostService;
  let prisma: PrismaService;

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [PostService, PrismaService],
    }).compile();

    service = module.get<PostService>(PostService);
    prisma = module.get<PrismaService>(PrismaService);
  });

  it('should create a post', async () => {
    const postData = {
      title: 'Test Post',
      content: 'Test content',
    };

    const result = await service.create(postData);
    
    expect(result).toBeDefined();
    expect(result.title).toBe(postData.title);
  });
});
```

---

## üö¢ Deployment

### Producci√≥n con Docker

#### 1. Build de Im√°genes
```bash
# Backend
cd apps/mi-backend-server
docker build -t blog-backend .

# Frontend
cd apps/mi-backend-admin
docker build -t blog-admin .
```

#### 2. Docker Compose Producci√≥n
```yaml
version: "3.8"
services:
  backend:
    image: blog-backend:latest
    environment:
      - NODE_ENV=production
      - DB_URL=postgresql://user:pass@db:5432/blog
    ports:
      - "3000:3000"
    depends_on:
      - db
      - redis

  admin:
    image: blog-admin:latest
    ports:
      - "80:80"
    depends_on:
      - backend

  db:
    image: postgres:12
    environment:
      POSTGRES_DB: blog
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

### Variables de Entorno Producci√≥n

```env
NODE_ENV=production
DB_URL=postgresql://user:password@host:5432/database
JWT_SECRET=your-super-secure-secret
REDIS_URL=redis://redis:6379
GRAPHQL_PLAYGROUND=false
GRAPHQL_INTROSPECTION=false
```

### Health Checks

El sistema incluye health checks en `/api/health`:

```typescript
// Verificar estado de la aplicaci√≥n
GET /api/health

// Response
{
  "status": "ok",
  "database": "connected",
  "redis": "connected",
  "uptime": 3600
}
```

---

## üìö Referencias

### Documentaci√≥n Oficial
- [NestJS Documentation](https://docs.nestjs.com/)
- [Prisma Documentation](https://www.prisma.io/docs/)
- [React Admin Documentation](https://marmelab.com/react-admin/)
- [Apollo Server Documentation](https://www.apollographql.com/docs/apollo-server/)

### Amplication
- [Amplication Platform](https://amplication.com/)
- [Amplication Documentation](https://docs.amplication.com/)

### Herramientas de Desarrollo
- [Docker Documentation](https://docs.docker.com/)
- [PostgreSQL Documentation](https://www.postgresql.org/docs/)
- [Redis Documentation](https://redis.io/documentation)

---

**üìû Soporte y Contribuciones**

Para reportar bugs o contribuir al proyecto, por favor crea un issue en el repositorio de GitHub.

**üìÑ Licencia**

Este proyecto est√° bajo la licencia MIT. Ver el archivo `LICENSE` para m√°s detalles.

---

*Documentaci√≥n generada autom√°ticamente - √öltima actualizaci√≥n: Octubre 2025*